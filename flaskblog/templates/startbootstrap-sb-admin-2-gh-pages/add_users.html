{% extends 'base.html' %} {% block content %}
<!-- Page Wrapper -->
<div id="wrapper">
  {% include 'Sidebar.html' %}
  <div id="content-wrapper" class="d-flex flex-column">
    <!-- Main Content -->
    <div id="content">
      {% include 'Topbar.html' %}

      <!-- Begin Page Content -->
      <div class="container-fluid">
        <!-- Page Heading -->
        <div
          class="d-sm-flex align-items-center justify-content-between mb-4"
        ></div>
        <ul class="nav nav-tabs" id="myTab" role="tablist">
          <li class="nav-item">
            <a
              class="nav-link active"
              id="home-tab"
              data-toggle="tab"
              href="#form"
              role="tab"
              aria-controls="home"
              aria-selected="true"
              >Formatteurs</a
            >
          </li>
          <li class="nav-item">
            <a
              class="nav-link"
              id="profile-tab"
              data-toggle="tab"
              href="#user"
              role="tab"
              aria-controls="profile"
              aria-selected="false"
              >Utilisateurs</a
            >
          </li>
        </ul>
        <div class="tab-content" id="myTabContent">
          <div
            class="tab-pane fade show active"
            id="form"
            role="tabpanel"
            aria-labelledby="contact-tab"
          >
            <div class="col-sm-12 course-section">
              <div class="section-title">
                Liste des formatteurs
              </div>
              <ul class="section-list">
                <li class="section-item">
                  <a class="item" href="#">
                    <span class="lecture-icon">
                      <i class="fa fa-youtube-play"></i>
                    </span>
                    <div class="float-left">
                      Document 1
                    </div>
                    <div class="btn-primary btn-sm float-right lecture-start">
                      Aperçu <i class="far fa-eye"></i>
                    </div>
                    <div class="btn-primary btn-sm float-right lecture-start">
                      Télécharger <i class="fas fa-download"></i>
                    </div>
                  </a>
                </li>

                <li class="section-item">
                  <a class="item" href="#">
                    <span class="lecture-icon">
                      <i class="fa fa-youtube-play"></i>
                    </span>
                    <div class="float-left">
                      Document 2
                    </div>
                    <div class="btn-primary btn-sm float-right lecture-start">
                      Aperçu <i class="far fa-eye"></i>
                    </div>
                    <div class="btn-primary btn-sm float-right lecture-start">
                      Télécharger <i class="fas fa-download"></i>
                    </div>
                  </a>
                </li>

                <li class="section-item">
                  <a class="item" href="#">
                    <span class="lecture-icon">
                      <i class="fa fa-youtube-play"></i>
                    </span>
                    <div class="float-left">Document 3</div>
                    <div class="btn-primary btn-sm float-right lecture-start">
                      Aperçu <i class="far fa-eye"></i>
                    </div>
                    <div class="btn-primary btn-sm float-right lecture-start">
                      Télécharger <i class="fas fa-download"></i>
                    </div>
                  </a>
                </li>

                <li class="section-item">
                  <a class="item" href="#">
                    <span class="lecture-icon">
                      <i class="fa fa-file-text"></i>
                    </span>
                    <div class="float-left">Document 4</div>
                    <div class="btn-primary btn-sm float-right lecture-start">
                      Aperçu <i class="far fa-eye"></i>
                    </div>
                    <div class="btn-primary btn-sm float-right lecture-start">
                      Télécharger <i class="fas fa-download"></i>
                    </div>
                  </a>
                </li>

                <li class="section-item">
                  <a class="item" href="#">
                    <span class="lecture-icon">
                      <i class="fa fa-youtube-play"></i>
                    </span>
                    <div class="float-left">Document 5</div>
                    <div class="btn-primary btn-sm float-right lecture-start">
                      Aperçu <i class="far fa-eye"></i>
                    </div>
                    <div class="btn-primary btn-sm float-right lecture-start">
                      Télécharger <i class="fas fa-download"></i>
                    </div>
                  </a>
                </li>
              </ul>
            </div>
            <div
              class="btn-primary btn-sm float-right lecture-start"
              data-toggle="modal"
              data-target="#addModal"
              type="button"
            >
              <i class="fas fa-plus-circle"></i>Ajouter un formatteur
            </div>
          </div>
          <div
            class="tab-pane fade"
            id="user"
            role="tabpanel"
            aria-labelledby="contact-tab"
          >
            <div class="col-sm-12 course-section">
              <div class="section-title">
                Liste des utlisateurs
              </div>
              <ul class="section-list">
                {% for user in users %}
                <li class="section-item">
                  <a class="item" href="#">
                    <span class="lecture-icon">
                      <i class="fa fa-youtube-play"></i>
                    </span>
                    <div class="float-left">
                      {{user.username}}
                    </div>
                    <div
                      class="btn-primary btn-sm float-right lecture-start"
                      data-toggle="modal"
                      data-target="#deleteModal"
                    >
                      Supprimer <i class="fas fa-trash-alt"></i>
                    </div>
                    <div
                      class="btn-primary btn-sm float-right lecture-start user"
                      data-username="{{user.username}}"
                      data-email="{{user.email}}"
                      data-img_path="{{user.image_file}}"
                      data-toggle="modal"
                      data-target="#modifyModal"
                    >
                      Modifier <i class="far fa-id-badge"></i>
                    </div>
                  </a>
                </li>
                {% endfor %}
              </ul>
            </div>
            <div
              class="btn btn-primary btn-sm float-right lecture-start"
              data-toggle="modal"
              data-target="#addModal"
              type="button"
            >
              <i class="fas fa-plus-circle"></i>Ajouter un utilisateur
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<div
  class="modal fade"
  id="modifyModal"
  tabindex="-1"
  role="dialog"
  aria-labelledby="exampleModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Modify current user</h5>
        <button
          class="close"
          type="button"
          data-dismiss="modal"
          aria-label="Close"
        >
          <span aria-hidden="true">×</span>
        </button>
      </div>
      <form
        method="POST"
        action=""
        enctype="multipart/form-data"
        id="update-form"
      >
        {{ form.hidden_tag() }}
        <div class="modal-body">
          <div class="container-fluid">
            <div class="content-section">
              <div class="media">
                <img
                  class="rounded-circle account-img col-4"
                  id="img-profile"
                  src="{{image_file}}"
                />
                <div class="media-body col-8">
                  <h2 class="account-heading" id="update-username">HI</h2>
                  <p class="text-secondary" id="update-email"></p>
                </div>
              </div>

              <fieldset class="form-group">
                <legend class="border-bottom mb-4">Account Info</legend>
                <div class="form-group">
                  {{ form.username.label(class="form-control-label") }} {% if
                  form.username.errors %} {{ form.username(class="form-control
                  form-control-lg is-invalid") }}
                  <div class="invalid-feedback">
                    {% for error in form.username.errors %}
                    <span>{{ error }}</span>
                    {% endfor %}
                  </div>
                  {% else %} {{ form.username(class="form-control
                  form-control-lg") }} {% endif %}
                </div>
                <div class="form-group">
                  {{ form.email.label(class="form-control-label") }} {% if
                  form.email.errors %} {{ form.email(class="form-control
                  form-control-lg is-invalid") }}
                  <div class="invalid-feedback">
                    {% for error in form.email.errors %}
                    <span>{{ error }}</span>
                    {% endfor %}
                  </div>
                  {% else %} {{ form.email(class="form-control form-control-lg")
                  }} {% endif %}
                </div>
                <div class="form-group">
                  {{ form.password.label(class="form-control-label") }} {% if
                  form.password.errors %} {{ form.password(class="form-control
                  form-control-lg is-invalid") }}
                  <div class="invalid-feedback">
                    {% for error in form.password.errors %}
                    <span>{{ error }}</span>
                    {% endfor %}
                  </div>
                  {% else %} {{ form.password(class="form-control
                  form-control-lg") }} {% endif %}
                </div>
              </fieldset>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" type="button" data-dismiss="modal">
            Cancel
          </button>
          {{ form.submit(class="btn btn-primary") }}
        </div>
      </form>
    </div>
  </div>
</div>
<div
  class="modal fade"
  id="deleteModal"
  tabindex="-1"
  role="dialog"
  aria-labelledby="exampleModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Delete this user</h5>
        <button
          class="close"
          type="button"
          data-dismiss="modal"
          aria-label="Close"
        >
          <span aria-hidden="true">×</span>
        </button>
      </div>
      <div class="modal-body">
        Are you sure you want to delete this user ?
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" type="button" data-dismiss="modal">
          Cancel
        </button>
        <a class="btn btn-primary" href="/logout">Delete</a>
      </div>
    </div>
  </div>
</div>
<div
  class="modal fade"
  id="addModal"
  tabindex="-1"
  role="dialog"
  aria-labelledby="exampleModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Delete this user</h5>
        <button
          class="close"
          type="button"
          data-dismiss="modal"
          aria-label="Close"
        >
          <span aria-hidden="true">×</span>
        </button>
      </div>
      <div class="modal-body">
        Add a new user :
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" type="button" data-dismiss="modal">
          Cancel
        </button>
        <a class="btn btn-primary" href="/logout">Confirm</a>
      </div>
    </div>
  </div>
</div>
<script>
  $(document).on("click", ".user", function () {
    let username = $(this).data("username");
    let email = $(this).data("email");
    let img_path = $(this).data("img_path");
    img_path = "2e32b4c96a8d8f10.jpg";
    var xhr = new XMLHttpRequest();
    xhr.open("POST", "/add_users", true);
    xhr.setRequestHeader("Content-Type", "application/json");
    let data = JSON.stringify({ username: username });
    xhr.send(data);
    /*img =({
        {
          url_for("static", (filename = "profile_pics/" + img_path));
        }
      });*/
    let img = "{{ url_for('static', filename='profile_pics/' +'image_file') }}".replace(
      "image_file",
      img_path
    );
    console.log(img_path);
    $(".modal-body .media #img-profile").attr("src", img);
    $(".modal-body .media #update-username").html(username);
    $(".modal-body .media #update-email").html(email);
    console.log($("#update-form").data("user"));
    $("#update-form").attr("data-user", username);
    // As pointed out in comments,
    // it is unnecessary to have to manually call the modal.
    // $('#addBookDialog').modal('show');
  });
</script>
{% endblock %}
